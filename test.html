<!DOCTYPE html>
<html lang="jp">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            background-color: #202020;
        }
        canvas {
            display: flex;
            margin: auto;
            background-color: #ffffff;
            border-right: 7px solid #00c11d;
            border-bottom: 7px solid #007812;
        }
        div {
            color: #fff;
        }
    </style>
</head>
<body>
    <div id="div"></div>
    <canvas id="canvas"></canvas>
    <script>
        const canvas=document.getElementById("canvas")
        const ctx=canvas.getContext("2d")
        const div = document.getElementById("div")
        
        const tag=['白','黒']

        canvas.height=640
        canvas.width=640
        
        const GRID=80
        const Row=Math.floor(canvas.clientHeight/GRID)
        const Col=Math.floor(canvas.clientWidth/GRID)
        let Coordinate = {}
        let playerKey=1

        const init=()=>{
    
            EmlDict={
                2:'000'
            }
            div.innerHTML="Player Turn:"+tag[playerKey-1]
            field=FieldSet()
            field[Math.floor(Row/2)][Math.floor(Col/2)]=1
            field[Math.floor(Row/2)][Math.floor(Col/2)-1]=2
            field[Math.floor(Row/2)-1][Math.floor(Col/2)-1]=1
            field[Math.floor(Row/2)-1][Math.floor(Col/2)]=2

        }

        const FieldSet=()=>{
            let field=[]
            for (i=0;i<Row;i++) {
                field[i]=[]
                for (j=0;j<Col;j++) {
                    field[i][j]=0
                }
            }
            return  field
        }

        const FieldDraw=()=>{
            ctx.clearRect(0,0,canvas.height,canvas.width)
            for (y=0;y<Row;y++) {
                for (x=0;x<Col;x++) {
                    elm=field[y][x]
                    ctx.beginPath()
                    if (elm==1) {
                        ctx.arc(x*GRID+(GRID/2),y*GRID+(GRID/2),(GRID/2)*0.8,0,Math.PI*2,true)
                        ctx.stroke()
                    }
                    if (elm==2) {
                        ctx.Style='#'+EmlDict[elm]
                        ctx.arc(x*GRID+(GRID/2),y*GRID+(GRID/2),(GRID/2)*0.8,0,Math.PI*2,true)
                        ctx.fill()
                        
                    }
                    ctx.strokeRect(x*GRID,y*GRID,GRID,GRID)
                    ctx.closePath()
                    
                }
            }

        }

        window.addEventListener("DOMContentLoaded",()=> {
            const ctx=document.getElementById('canvas')
            ctx.addEventListener("click",e=> {
                const rect=e.target.getBoundingClientRect()

                const vX=e.clientX-rect.left
                const vY=e.clientY-rect.top

                const sw=ctx.clientWidth/ctx.width
                const sh=ctx.clientHeight/ctx.height

                const Y=Math.floor(vY/sh)
                const X=Math.floor(vX/sw)

                Coordinate[playerKey]=[Math.floor(Y/GRID),Math.floor(X/GRID)]

            })
        })
        const playerCounter = (playerKey) => {
            playerKey=(playerKey+1)%3
            if (playerKey==0) {
                playerKey+=1
            }
            return playerKey
        }
        const turnOver = (y,x) => {
            field[y][x]=playerKey
            dxy=[[1,0],[0,1],[1,1],[-1,0],[0,-1],[1,-1],[-1,1],[-1,-1]]
            for (dIdx=0;dIdx<dxy.length;dIdx++) {
                dy=dxy[dIdx][0]
                dx=dxy[dIdx][1]
                let nowy=y
                let nowx=x
                let yy=-1
                let xx=-1

                let cor=[]
                let cnt=0
                while ((nowy+dy>=0 && nowy+dy<Row) && (nowx+dx>=0 && nowx+dx<Col)) {
                    if (field[nowy+dy][nowx+dx]==0) {
                        break
                    }
                    if (field[nowy+dy][nowx+dx]==playerKey) {
                        for (i=0;i<cor.length;i++) {
                            yy=cor[i][0]
                            xx=cor[i][1]
                            field[yy][xx]=playerKey
                        }
                        break
                    }
                    else {
                        cor[cnt]=[nowy+dy,nowx+dx]
                        cnt+=1
                    }
                    nowy+=dy
                    nowx+=dx
                }
            }
        }
        const putCheck=(y,x)=>{
            if (!((y>=0 && y<Row) && (x>=0 && x<Col))) {
                return 0
            }
            if (field[y][x]!=0) {
                return 0
            } 
            dxy=[[1,0],[0,1],[1,1],[-1,0],[0,-1],[1,-1],[-1,1],[-1,-1]]
            let cnt=0
            for (dIdx=0;dIdx<dxy.length;dIdx++) {
                dy=dxy[dIdx][0]
                dx=dxy[dIdx][1]
                let nowy=y
                let nowx=x
                let c=0

                while ((nowy+dy>=0 && nowy+dy<Row) && (nowx+dx>=0 && nowx+dx<Col)) {
                    if (field[nowy+dy][nowx+dx]==0) {
                        c=0
                        break
                    }
                    if (field[nowy+dy][nowx+dx]==playerKey) {
                        break
                    }
                    else {
                        c+=1
                    }
                    nowy+=dy
                    nowx+=dx
                }
                if (!((nowy+dy>=0 && nowy+dy<Row) && (nowx+dx>=0 && nowx+dx<Col))) {
                    c=0
                }
                cnt+=c
            }
            return cnt
        }
        const allCheck=(playerKey)=> {
            for (y=0;y<Row;y++) {
                for (x=0;x<Col;x++) {
                    if (putCheck(y,x)) {
                        return false
                    }
                }
            }
            return true

        }
        const judge=()=>{
            let a=0
            let b=0
            for (y=0;y<Row;y++) {
                for (x=0;x<Col;x++) {
                    if (field[y][x]==1) {
                        a+=1
                    }
                    else if (field[y][x]==2) {
                        b+=1
                    }
                }
            }
            window.alert('終了 '+'白'+a+'黒'+b)
            // if (a>b) {
            //     window.alert('winner 白')
            //     window.alert('黒 zakoooooooooo!')
            // } else if (b>a) {
            //     window.alert('winner 黒')
            //     window.alert('白 zakoooooooooo!')

            // } else {
            //     window.alert('引き分け')
            // }
        }
        const AI = () => {
            let mxsc=0
            let tmp=0
            let y=-2
            let x=-2
            for (i=0;i<Row;i++) {
                for (j=0;j<Col;j++) {
                    tmp=putCheck(i,j)
                    if (tmp>mxsc) {
                        mxsc=tmp
                        y=i
                        x=j
                    }
                }
            }
            Coordinate[playerKey]=[y,x]
            return 
            

        }
        const loop=()=>{
            if (allCheck(playerKey)) {
                playerKey=playerCounter(playerKey)
                if (allCheck(playerKey)) {
                    judge()
                    init()
                    return
                }
            }
            if (Coordinate[playerKey]!=undefined) {
                let crd=[]
                crd=Object.values(Coordinate[playerKey])
                y=crd[0]
                x=crd[1]
                delete Coordinate[playerKey]
                if (putCheck(y,x)) {
                    turnOver(y,x)
                    playerKey=playerCounter(playerKey)
                }
                div.innerHTML="Player Turn:"+tag[playerKey-1]
            }
            if (playerKey!=1) {
                AI()
            }
            // if (playerKey) {
            //     AI()
            // }
            // delete Coordinate[playerKey]
            FieldDraw()
        }

        init()
        setInterval(loop,1000/2)
    </script>
</body>
</html>,